<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thi Ti·∫øng Vi·ªát - L·ªõp 4</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Nunito', sans-serif; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
        .hidden-section { display: none; }
    </style>
</head>
<body class="bg-blue-50 h-screen flex flex-col overflow-hidden">

    <header class="bg-blue-600 text-white p-3 flex justify-between items-center shadow-md shrink-0">
        <div class="flex items-center gap-4">
            <h1 class="font-bold text-xl uppercase">Ti·∫øng Vi·ªát L·ªõp 4 - ƒê·ªÅ 1</h1>
            <input type="text" id="hoTen" placeholder="Nh·∫≠p H·ªç T√™n..." class="text-black px-3 py-1 rounded w-64 border-2 border-yellow-400 focus:outline-none font-bold">
            <input type="text" id="lop" placeholder="L·ªõp" class="text-black px-3 py-1 rounded w-20 border-2 border-yellow-400 focus:outline-none font-bold text-center">
        </div>
        <div class="bg-red-600 px-4 py-2 rounded-full font-black text-lg border-2 border-white shadow animate-pulse">
            ‚è±Ô∏è <span id="dongHo">20:00</span>
        </div>
    </header>

    <div id="phan1" class="flex-1 flex flex-col md:flex-row overflow-hidden">
        
        <div class="md:w-1/2 p-6 overflow-y-auto bg-white border-r-4 border-blue-200">
            <div class="bg-orange-100 p-4 rounded-lg mb-4 border-l-4 border-orange-500">
                <h2 class="text-2xl font-bold text-orange-800 text-center mb-2">L·ªúI TH√å TH·∫¶M C·ª¶A KHU V∆Ø·ªúN</h2>
                <div class="text-gray-800 text-lg leading-relaxed text-justify">
                    <p class="mb-2">Nh√† t√¥i c√≥ m·ªôt khu v∆∞·ªùn r·∫•t r·ªông, tr·ªìng nhi·ªÅu hoa. Nh·ªØng bu·ªïi chi·ªÅu, t√¥i hay nh·∫Øm m·∫Øt s·ªù nh·ªØng b√¥ng hoa v√† t·∫≠p ƒëo√°n. Kh√¥ng bao l√¢u, t√¥i ƒë√£ ƒëo√°n ƒë∆∞·ª£c h·∫øt v∆∞·ªùn hoa.</p>
                    <p class="mb-2">T·ª´ trong nh√† ra ngo√†i v∆∞·ªùn, t√¥i c√≥ th·ªÉ ch·∫°m v√†o b·∫•t c·ª© lo·∫°i c√¢y n√†o v√† n√≥i ƒë√∫ng t√™n c·ªßa n√≥. B·ªë nghƒ© ra tr√≤ ch∆°i, thay v√¨ ch·∫°m v√†o hoa, t√¥i ch·ªâ ƒë∆∞·ª£c ng·ª≠i r·ªìi g·ªçi t√™n n√≥. B·ªë ƒë∆∞a b√¥ng hoa ra tr∆∞·ªõc m≈©i t√¥i r·ªìi h·ªèi: ‚ÄúHoa g√¨?‚Äù. Tr√≤ ch∆°i c·ª© di·ªÖn ra li√™n t·ª•c cho ƒë·∫øn h·ªìi t√¥i nh·∫≠n di·ªán ƒë∆∞·ª£c t·∫•t c·∫£ c√°c m√πi h∆∞∆°ng c·ªßa c√°c lo√†i hoa.</p>
                    <p class="mb-2">B·∫°n h√£y t∆∞·ªüng t∆∞·ª£ng, m·ªôt bu·ªïi s√°ng m·ªù s∆∞∆°ng, b·∫°n v·ª´a nh·∫Øm m·∫Øt v·ª´a m·ªü c·ª≠a s·ªï, v√† b·∫°n ch·ª£t hi·ªÉu khu v∆∞·ªùn n√≥i g√¨. B·∫°n hi·ªÉu b√¢y gi·ªù l√† m√πa g√¨ v√† b√¥ng hoa n√†o ƒëang n·ªü, t√™n g√¨.</p>
                    <p class="mb-2">B·∫°n h√£y th·ª≠ ƒëi r·ªìi s·∫Ω th·∫•y, khu v∆∞·ªùn s·∫Ω l·ªõn l√™n r·∫•t nhi·ªÅu. Nh·ªØng b√¥ng hoa th∆°m h∆°n v√† khi nh·∫Øm m·∫Øt, b·∫°n v·∫´n nh√¨n th·∫•y ch√∫ng. Kh√¥ng ch·ªâ v·∫≠y, b·∫°n c√≤n th·∫•y nguy√™n c·∫£ khu v∆∞·ªùn. B·∫°n c√≥ th·ªÉ nh√¨n th·∫•y b√¥ng h·ªìng ngay trong ƒë√™m t·ªëi. ƒê√™m b·∫°n n·∫±m, ƒë·∫Øp chƒÉn k√≠n ng∆∞·ªùi nh∆∞ng b·∫°n v·∫´n c√≥ th·ªÉ ƒëi d·∫°o.</p>
                    <p class="mb-2">B·∫°n s·∫Ω kh√¥ng bao gi·ªù l·∫°c trong b·∫•t c·ª© m·ªôt khu v∆∞·ªùn n√†o, b·ªüi v√¨, nh·ªØng b√¥ng hoa s·∫Ω ch·ªâ l·ªëi cho b·∫°n, m·ªôt l·ªëi ƒëi an to√†n v√† th∆°m ng√°t.</p>
                    <p class="text-right italic font-bold">(Theo Nguy·ªÖn Ng·ªçc Thu·∫ßn)</p>
                </div>
            </div>
            
            <div class="mt-8 bg-blue-100 p-4 rounded-xl border-2 border-blue-400 text-center">
                <p class="text-gray-600 text-sm uppercase font-bold">üéÅ H√© l·ªô ƒë·ªÅ thi Ph·∫ßn 2:</p>
                <p class="text-blue-800 font-bold text-xl mt-1">B√†i ƒë·ªçc th√†nh ti·∫øng c·ªßa con l√†:</p>
                <h3 id="tenBaiDocRandom" class="text-red-600 text-2xl font-black uppercase my-2">...</h3>
            </div>
        </div>

        <div class="md:w-1/2 p-6 overflow-y-auto bg-gray-50">
            <h3 class="text-xl font-bold text-blue-700 mb-4 sticky top-0 bg-gray-50 py-2 border-b">üìù Tr·∫£ l·ªùi c√¢u h·ªèi</h3>
            
            <div class="space-y-6">
                <div class="bg-white p-4 rounded shadow">
                    <p class="font-bold">C√¢u 1: B·∫°n nh·ªè ƒë√£ kh√°m ph√° khu v∆∞·ªùn nh√† m√¨nh b·∫±ng c√°ch n√†o?</p>
                    <div class="mt-2 space-y-2">
                        <label class="block"><input type="radio" name="cau1" value="A"> A. ChƒÉm s√≥c c√¢y trong v∆∞·ªùn.</label>
                        <label class="block"><input type="radio" name="cau1" value="B"> B. Nh√¨n c√°c lo√†i hoa trong v∆∞·ªùn.</label>
                        <label class="block"><input type="radio" name="cau1" value="C"> C. T·∫≠p c·∫£m nh·∫≠n c√°c lo√†i hoa b·∫±ng x√∫c gi√°c v√† kh·ª©u gi√°c.</label>
                        <label class="block"><input type="radio" name="cau1" value="D"> D. V·ª´a nh·∫Øm m·∫Øt v·ª´a m·ªü c·ª≠a s·ªï ƒë·ªÉ h√≠t th·ªü.</label>
                    </div>
                </div>

                <div class="bg-white p-4 rounded shadow">
                    <p class="font-bold">C√¢u 2: Ng∆∞·ªùi b·ªë ƒë√£ nghƒ© ra tr√≤ ch∆°i g√¨ ƒë·ªÉ tƒÉng ƒë·ªô kh√≥?</p>
                    <div class="mt-2 space-y-2">
                        <label class="block"><input type="radio" name="cau2" value="A"> A. V·∫Ω l·∫°i h√¨nh d√°ng c√°c b√¥ng hoa.</label>
                        <label class="block"><input type="radio" name="cau2" value="B"> B. Thay v√¨ ch·∫°m v√†o hoa, ch·ªâ ƒë∆∞·ª£c ng·ª≠i r·ªìi g·ªçi t√™n n√≥.</label>
                        <label class="block"><input type="radio" name="cau2" value="C"> C. Tr·ªìng th√™m nhi·ªÅu lo√†i hoa l·∫°.</label>
                    </div>
                </div>

                <div class="bg-white p-4 rounded shadow">
                    <p class="font-bold">C√¢u 3: Theo t√°c gi·∫£, khi nh·∫Øm m·∫Øt v√† c·∫£m nh·∫≠n, ƒëi·ªÅu k√¨ di·ªáu n√†o x·∫£y ra?</p>
                    <div class="mt-2 space-y-2">
                        <label class="block"><input type="radio" name="cau3" value="A"> A. Nh·ªØng b√¥ng hoa s·∫Ω nhanh t√†n h∆°n.</label>
                        <label class="block"><input type="radio" name="cau3" value="B"> B. B·∫°n s·∫Ω kh√¥ng c√≤n nh√¨n th·∫•y g√¨ n·ªØa.</label>
                        <label class="block"><input type="radio" name="cau3" value="C"> C. Khu v∆∞·ªùn s·∫Ω l·ªõn l√™n r·∫•t nhi·ªÅu v√† nh·ªØng b√¥ng hoa th∆°m h∆°n.</label>
                    </div>
                </div>

                <div class="bg-white p-4 rounded shadow">
                    <p class="font-bold">C√¢u 4: T√¨m ƒë·ªông t·ª´ trong c√¢u: ‚Äúƒê√™m b·∫°n n·∫±m, ƒë·∫Øp chƒÉn k√≠n ng∆∞·ªùi nh∆∞ng b·∫°n v·∫´n c√≥ th·ªÉ ƒëi d·∫°o‚Äù:</p>
                    <input type="text" id="cau4_tuluan" class="w-full border p-2 mt-2 rounded" placeholder="Nh·∫≠p c√¢u tr·∫£ l·ªùi...">
                </div>

                <div class="bg-white p-4 rounded shadow">
                    <p class="font-bold">C√¢u 5: T·∫°i sao t√°c gi·∫£ kh·∫≥ng ƒë·ªãnh: ‚ÄúB·∫°n s·∫Ω kh√¥ng bao gi·ªù l·∫°c trong b·∫•t c·ª© m·ªôt khu v∆∞·ªùn n√†o‚Äù?</p>
                    <div class="mt-2 space-y-2">
                        <label class="block"><input type="radio" name="cau5" value="A"> A. V√¨ c√°c khu v∆∞·ªùn ƒë·ªÅu c√≥ thi·∫øt k·∫ø gi·ªëng nhau.</label>
                        <label class="block"><input type="radio" name="cau5" value="B"> B. V√¨ nh·ªØng b√¥ng hoa s·∫Ω ch·ªâ cho b·∫°n m·ªôt l·ªëi ƒëi an to√†n.</label>
                        <label class="block"><input type="radio" name="cau5" value="C"> C. V√¨ nh·ªØng khu v∆∞·ªùn r·∫•t nh·ªè.</label>
                    </div>
                </div>

                 <div class="bg-white p-4 rounded shadow">
                    <p class="font-bold">C√¢u 6: Th√¥ng ƒëi·ªáp ch√≠nh m√† b√†i vƒÉn mu·ªën g·ª≠i g·∫Øm l√† g√¨?</p>
                    <div class="mt-2 space-y-2">
                        <label class="block"><input type="radio" name="cau6" value="A"> A. H√£y tr·ªìng th·∫≠t nhi·ªÅu hoa.</label>
                        <label class="block"><input type="radio" name="cau6" value="B"> B. H√£y y√™u m·∫øn thi√™n nhi√™n v√† c·∫£m nh·∫≠n th·∫ø gi·ªõi b·∫±ng c·∫£ t√¢m h·ªìn.</label>
                        <label class="block"><input type="radio" name="cau6" value="C"> C. C·∫ßn h·ªçc thu·ªôc t√™n c√°c lo√†i c√¢y.</label>
                    </div>
                </div>

                <div class="bg-white p-4 rounded shadow">
                    <p class="font-bold">C√¢u 7: H√£y vi·∫øt 5 danh t·ª´ ch·ªâ ƒë·ªì d√πng h·ªçc t·∫≠p c·ªßa em:</p>
                    <input type="text" id="cau7_tuluan" class="w-full border p-2 mt-2 rounded" placeholder="V√≠ d·ª•: b√∫t, th∆∞·ªõc...">
                </div>

                <div class="bg-white p-4 rounded shadow">
                    <p class="font-bold">C√¢u 8: Ph∆∞∆°ng √°n n√†o sau ƒë√¢y KH√îNG ph·∫£i c√¥ng d·ª•ng c·ªßa d·∫•u g·∫°ch ngang?</p>
                    <div class="mt-2 space-y-2">
                        <label class="block"><input type="radio" name="cau8" value="A"> A. N·ªëi c√°c th√†nh ph·∫ßn trong m·ªôt li√™n danh.</label>
                        <label class="block"><input type="radio" name="cau8" value="B"> B. ƒê√°nh d·∫•u t√™n m·ªôt t√°c ph·∫©m.</label>
                        <label class="block"><input type="radio" name="cau8" value="C"> C. ƒê√°nh d·∫•u l·ªùi n√≥i tr·ª±c ti·∫øp c·ªßa nh√¢n v·∫≠t.</label>
                    </div>
                </div>

                <div class="bg-white p-4 rounded shadow">
                    <p class="font-bold">C√¢u 9: S·ª≠ d·ª•ng bi·ªán ph√°p so s√°nh ƒë·ªÉ ƒë·∫∑t c√¢u n√≥i v·ªÅ v·∫ª ƒë·∫πp c·ªßa m·ªôt b√¥ng hoa:</p>
                    <input type="text" id="cau9_tuluan" class="w-full border p-2 mt-2 rounded" placeholder="Nh·∫≠p c√¢u tr·∫£ l·ªùi...">
                </div>

            </div>

            <button onclick="nopPhan1()" class="w-full bg-blue-600 text-white font-bold py-4 mt-6 rounded-xl text-xl shadow-lg hover:bg-blue-700 transition">
                N·ªòP PH·∫¶N 1 ‚ûú SANG PH·∫¶N 2
            </button>
        </div>
    </div>


    <div id="phan2" class="hidden-section flex-1 flex flex-col items-center justify-center p-8 bg-indigo-50 text-center h-full">
        <div class="bg-white max-w-3xl w-full p-8 rounded-2xl shadow-2xl border-t-8 border-indigo-600">
            <h2 class="text-3xl font-bold text-indigo-800 mb-4">üé§ PH·∫¶N 2: ƒê·ªåC TH√ÄNH TI·∫æNG</h2>
            
            <div class="bg-indigo-100 p-6 rounded-xl mb-6">
                <p class="text-gray-700 text-lg mb-2">Con h√£y m·ªü S√°ch Gi√°o Khoa Ti·∫øng Vi·ªát 4 v√† ƒë·ªçc to b√†i:</p>
                <h3 id="hienThiBaiDoc" class="text-4xl font-extrabold text-red-600 uppercase mb-4">...</h3>
                <p class="text-indigo-600 font-bold bg-white inline-block px-4 py-2 rounded-full shadow">
                    üì± Nh·ªù b·ªë m·∫π quay video v√† g·ª≠i Zalo cho Th·∫ßy nh√©!
                </p>
            </div>
            <button onclick="nopPhan2()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-full text-xl shadow-lg transition animate-bounce">
                ‚úÖ Con ƒë√£ g·ª≠i Video qua Zalo
            </button>
        </div>
    </div>


    <div id="phan3" class="hidden-section flex-1 p-4 md:p-8 overflow-y-auto">
        <div class="max-w-4xl mx-auto">
            <div class="bg-yellow-100 border-l-8 border-yellow-500 p-6 rounded-r-lg mb-6 shadow">
                <h2 class="text-2xl font-bold text-yellow-800 mb-2">‚úçÔ∏è PH·∫¶N 3: T·∫¨P L√ÄM VƒÇN</h2>
                <p class="text-xl font-bold text-gray-800">ƒê·ªÅ b√†i: <span class="text-red-600">Mi√™u t·∫£ m·ªôt con v·∫≠t m√† em ƒë√£ chƒÉm s√≥c v√† g·∫Øn b√≥.</span></p>
            </div>

            <div class="bg-white border-2 border-green-200 rounded-xl p-6 shadow-lg mb-6">
                <h3 class="text-lg font-bold text-green-700 mb-3">üí° G·ª¢I √ù L√ÄM B√ÄI:</h3>
                <div class="space-y-2 text-gray-700">
                    <p><span class="font-bold bg-green-100 px-2 rounded">1. M·ªü b√†i:</span> Gi·ªõi thi·ªáu con v·∫≠t (ƒê√≥ l√† con g√¨? T√™n l√† g√¨? Em nu√¥i t·ª´ bao gi·ªù?).</p>
                    <p><span class="font-bold bg-green-100 px-2 rounded">2. Th√¢n b√†i:</span></p>
                    <ul class="list-disc ml-8 text-sm">
                        <li><b>T·∫£ h√¨nh d√°ng:</b> B·ªô l√¥ng m√†u g√¨? ƒê√¥i m·∫Øt, c√°i tai, c√°i ƒëu√¥i... c√≥ g√¨ ƒë·∫∑c bi·ªát?</li>
                        <li><b>T·∫£ ho·∫°t ƒë·ªông:</b> Khi ƒÉn, khi ng·ªß, khi ch∆°i ƒë√πa v·ªõi em...</li>
                        <li><b>K·ª∑ ni·ªám:</b> M·ªôt k·ªâ ni·ªám ƒë√°ng nh·ªõ gi·ªØa em v√† con v·∫≠t ƒë√≥.</li>
                    </ul>
                    <p><span class="font-bold bg-green-100 px-2 rounded">3. K·∫øt b√†i:</span> T√¨nh c·∫£m c·ªßa em (Em y√™u qu√Ω v√† chƒÉm s√≥c n√≥ nh∆∞ th·∫ø n√†o?).</p>
                </div>
            </div>

            <div class="text-center mt-8 p-6 bg-gray-100 rounded-xl">
                <p class="text-gray-700 font-bold mb-4 text-lg">Con h√£y vi·∫øt b√†i ra gi·∫•y thi, ch·ª•p ·∫£nh v√† g·ª≠i Zalo cho Th·∫ßy.</p>
                <button onclick="nopPhan3()" class="bg-red-600 hover:bg-red-700 text-white font-bold py-4 px-12 rounded-full text-2xl shadow-xl transition transform hover:scale-105">
                    üöÄ N·ªòP B√ÄI VƒÇN (HO√ÄN TH√ÄNH)
                </button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, updateDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // C·∫§U H√åNH FIREBASE (D√πng SenderID chu·∫©n 9538...)
        const firebaseConfig = {
            apiKey: "AIzaSyA77lLi_JCLIdR535KEfg3S0_Ge2EorPMo", 
            authDomain: "baikiemtracuoiki.firebaseapp.com",
            projectId: "baikiemtracuoiki",
            storageBucket: "baikiemtracuoiki.appspot.com",
            messagingSenderId: "953819948776",
            appId: "1:953819948776:web:15848507d350f37c35e5d3"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // --- C·∫§U H√åNH ƒê·ªÄ THI ---
        const LIST_BAI_DOC = ["D·∫ø M√®n b√™nh v·ª±c k·∫ª y·∫øu", "Truy·ªán c·ªï n∆∞·ªõc m√¨nh", "Tre Vi·ªát Nam", "Ng∆∞·ªùi ƒÉn xin", "V·ªÅ thƒÉm b√†"];
        let TIME_P1 = 20; 
        let TIME_P2 = 10;
        let TIME_P3 = 35;
        
        // Bi·∫øn to√†n c·ª•c
        let baiDocDuocChon = "";
        let docId = null;
        let timerInterval;

        window.onload = function() {
            // Random b√†i ƒë·ªçc
            baiDocDuocChon = LIST_BAI_DOC[Math.floor(Math.random() * LIST_BAI_DOC.length)];
            document.getElementById('tenBaiDocRandom').innerText = baiDocDuocChon;
            document.getElementById('hienThiBaiDoc').innerText = baiDocDuocChon;

            // B·∫Øt ƒë·∫ßu ƒë·∫øm ng∆∞·ª£c Ph·∫ßn 1
            startTimer(TIME_P1, function() {
                alert("‚è∞ H·∫øt gi·ªù Ph·∫ßn 1! H·ªá th·ªëng t·ª± chuy·ªÉn sang Ph·∫ßn 2.");
                nopPhan1();
            });
        };

        function startTimer(minutes, callback) {
            clearInterval(timerInterval);
            let time = minutes * 60;
            const display = document.getElementById('dongHo');
            
            timerInterval = setInterval(() => {
                let m = Math.floor(time / 60);
                let s = time % 60;
                display.innerText = `${m < 10 ? '0'+m : m}:${s < 10 ? '0'+s : s}`;
                time--;
                if (time < 0) {
                    clearInterval(timerInterval);
                    callback();
                }
            }, 1000);
        }

        // H√ÄM CH·∫§M ƒêI·ªÇM TR·∫ÆC NGHI·ªÜM
        function check(cau, dapAnDung, diem) {
            const luaChon = document.querySelector(`input[name="${cau}"]:checked`);
            if (luaChon && luaChon.value === dapAnDung) return diem;
            return 0;
        }

        window.nopPhan1 = async function() {
            const hoTen = document.getElementById('hoTen').value.trim() || "Qu√™n t√™n";
            const lop = document.getElementById('lop').value.trim() || "Kƒê";

            // CH·∫§M ƒêI·ªÇM T·ª∞ ƒê·ªòNG (D·ª±a tr√™n ƒë√°p √°n ƒë√£ ch·ªët)
            let diem = 0;
            diem += check("cau1", "C", 0.5); // C. X√∫c gi√°c, kh·ª©u gi√°c
            diem += check("cau2", "B", 0.5); // B. Ng·ª≠i g·ªçi t√™n
            diem += check("cau3", "C", 0.5); // C. V∆∞·ªùn l·ªõn l√™n
            diem += check("cau5", "B", 0.5); // B. Hoa ch·ªâ l·ªëi
            diem += check("cau6", "B", 0.5); // B. Y√™u thi√™n nhi√™n
            diem += check("cau8", "B", 1.0); // B. T√™n t√°c ph·∫©m (Sai c√¥ng d·ª•ng g·∫°ch ngang)

            // L·∫•y n·ªôi dung T·ª± lu·∫≠n ƒë·ªÉ Th·∫ßy ch·∫•m sau
            const tuLuan = `
                C√¢u 4: ${document.getElementById('cau4_tuluan').value}
                C√¢u 7: ${document.getElementById('cau7_tuluan').value}
                C√¢u 9: ${document.getElementById('cau9_tuluan').value}
            `;

            // Chuy·ªÉn giao di·ªán
            document.getElementById('phan1').classList.add('hidden-section');
            document.getElementById('phan2').classList.remove('hidden-section');
            
            try {
                const docRef = await addDoc(collection(db, "Baikiemtracuoiki"), {
                    ho_ten: hoTen, lop: lop, mon_hoc: "Ti·∫øng Vi·ªát",
                    diem_trac_nghiem: diem, // M√°y ch·∫•m s∆° b·ªô
                    diem_tu_luan: 0, // Th·∫ßy ch·∫•m sau
                    bai_tu_luan: tuLuan,
                    bai_doc_thanh_tieng: baiDocDuocChon,
                    trang_thai_doc: "ƒêang ch·ªù n·ªôp Zalo",
                    trang_thai_viet: "Ch∆∞a l√†m",
                    thoi_gian_nop_p1: new Date().toISOString()
                });
                docId = docRef.id;
            } catch (e) { console.error(e); }

            startTimer(TIME_P2, function() {
                alert("‚è∞ H·∫øt gi·ªù n·ªôp Video! Chuy·ªÉn sang ph·∫ßn T·∫≠p l√†m vƒÉn.");
                nopPhan2(true);
            });
        }

        window.nopPhan2 = async function(auto = false) {
            document.getElementById('phan2').classList.add('hidden-section');
            document.getElementById('phan3').classList.remove('hidden-section');

            if (docId) {
                await updateDoc(doc(db, "Baikiemtracuoiki", docId), {
                    trang_thai_doc: auto ? "H·∫øt gi·ªù (Ch∆∞a b·∫•m n·ªôp)" : "ƒê√£ n·ªôp Zalo"
                });
            }
            startTimer(TIME_P3, function() {
                alert("‚è∞ H·∫øt gi·ªù l√†m b√†i! H·ªá th·ªëng t·ª± ƒë·ªông thu b√†i.");
                nopPhan3(true);
            });
        }

        window.nopPhan3 = async function(auto = false) {
            const btn = document.querySelector('#phan3 button');
            btn.disabled = true;
            btn.innerText = "ƒêang ho√†n t·∫•t...";

            if (docId) {
                await updateDoc(doc(db, "Baikiemtracuoiki", docId), {
                    trang_thai_viet: auto ? "H·∫øt gi·ªù (Ch∆∞a b·∫•m n·ªôp)" : "ƒê√£ n·ªôp Zalo",
                    thoi_gian_nop_cuoi: new Date().toISOString()
                });
            }
            
            alert("üéâ CH√öC M·ª™NG CON ƒê√É HO√ÄN TH√ÄNH B√ÄI THI TI·∫æNG VI·ªÜT!\nTh·∫ßy s·∫Ω ch·∫•m ƒëi·ªÉm T·∫≠p l√†m vƒÉn v√† ƒê·ªçc th√†nh ti·∫øng tr√™n Zalo nh√©.");
            location.href = "../index.html";
        }
    </script>
</body>
</html>
