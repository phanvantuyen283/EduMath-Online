<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ƒê·ªÅ To√°n S·ªë 1 - C√≥ L·ªùi Gi·∫£i Chi Ti·∫øt</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Nunito', sans-serif; }
        .question-box { background-color: #F9FAFB; border-left: 4px solid #3B82F6; padding: 1rem; margin-bottom: 1.5rem; border-radius: 0.5rem; transition: all 0.3s; }
        .question-title { font-weight: 700; color: #1F2937; margin-bottom: 0.5rem; display: block; }
        input[type="radio"] { width: 1.2rem; height: 1.2rem; margin-right: 0.5rem; vertical-align: middle; }
        input[type="text"], input[type="number"] { border: 1px solid #D1D5DB; padding: 0.5rem; border-radius: 0.25rem; width: 100%; max-width: 200px; font-weight: bold; color: #1E40AF; }
        
        /* Style cho √¥ nh·∫≠p t·ª± lu·∫≠n */
        textarea { width: 100%; padding: 12px; border: 2px solid #D1D5DB; border-radius: 8px; font-family: 'Courier New', Courier, monospace; color: #1e3a8a; background: #fff; min-height: 100px; transition: border-color 0.3s; }
        textarea:focus { border-color: #3B82F6; outline: none; }
        
        .section-header { background-color: #DBEAFE; color: #1E3A8A; font-weight: 900; padding: 0.75rem; border-radius: 0.5rem; margin-bottom: 1rem; text-transform: uppercase; }
        
        /* Style cho ph·∫ßn Gi·∫£i th√≠ch (·∫®n m·∫∑c ƒë·ªãnh) */
        .correct-answer { background-color: #DCFCE7 !important; border-color: #22C55E !important; } 
        .wrong-answer { background-color: #FEE2E2 !important; border-color: #EF4444 !important; }
        .explanation { display: none; margin-top: 15px; padding: 15px; background-color: #FFF7ED; border: 1px dashed #F97316; border-radius: 8px; color: #9A3412; font-size: 0.95rem; line-height: 1.6; }
        .explanation strong { color: #C2410C; }
    </style>
</head>
<body class="bg-blue-50 py-8 min-h-screen">

    <div class="fixed top-4 right-4 bg-red-600 text-white font-bold py-2 px-4 rounded-full shadow-lg z-50 animate-pulse border-2 border-white">
        ‚è≥ <span id="dongHo">35:00</span>
    </div>

    <div class="max-w-4xl mx-auto bg-white p-8 rounded-xl shadow-xl">
        
        <div class="text-center mb-8 border-b-2 border-blue-200 pb-4">
            <h1 class="text-3xl font-black text-blue-800 uppercase">KI·ªÇM TRA CU·ªêI H·ªåC K√å 1</h1>
            <p class="text-xl text-gray-600 font-bold mt-2">M√¥n: TO√ÅN - L·ªõp 4 (ƒê·ªÅ 1)</p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8 bg-blue-50 p-4 rounded-lg">
            <div>
                <label class="block font-bold text-gray-700">H·ªç v√† t√™n:</label>
                <input type="text" id="hoTen" class="w-full mt-1 p-2 border rounded outline-none" placeholder="Nh·∫≠p h·ªç t√™n...">
            </div>
            <div>
                <label class="block font-bold text-gray-700">L·ªõp:</label>
                <input type="text" id="lop" class="w-full mt-1 p-2 border rounded outline-none" placeholder="VD: 4A">
            </div>
        </div>

        <div class="section-header">I. Tr·∫Øc Nghi·ªám (4 ƒëi·ªÉm)</div>

        <div class="question-box" id="box_cau1">
            <label class="question-title">C√¢u 1 (0.5ƒë): ƒêi·ªÅn s·ªë th√≠ch h·ª£p: 2 175, 2 177, 2 179, ...</label>
            <input type="number" id="cau1" placeholder="...">
            <div class="explanation" id="giai_cau1">üí° <b>ƒê√°p √°n:</b> 2181<br><i>(Quy lu·∫≠t: S·ªë l·∫ª li√™n ti·∫øp c·ªông th√™m 2 ƒë∆°n v·ªã).</i></div>
        </div>

        <div class="question-box" id="box_cau2">
            <label class="question-title">C√¢u 2 (0.5ƒë): H√¨nh v·∫Ω sau ƒë√¢y c√≥ bao nhi√™u g√≥c vu√¥ng?</label>
            <img src="../images/toan/de1/Cau2.jpg" alt="Hinh 2" class="my-3 max-h-40 rounded border shadow-sm block">
            <div class="grid grid-cols-2 gap-2" id="group_cau2">
                <label class="p-2 rounded border cursor-pointer hover:bg-gray-50"><input type="radio" name="cau2" value="A"> A. 2 g√≥c vu√¥ng</label>
                <label class="p-2 rounded border cursor-pointer hover:bg-gray-50"><input type="radio" name="cau2" value="B"> B. 3 g√≥c vu√¥ng</label>
                <label class="p-2 rounded border cursor-pointer hover:bg-gray-50"><input type="radio" name="cau2" value="C"> C. 4 g√≥c vu√¥ng</label>
                <label class="p-2 rounded border cursor-pointer hover:bg-gray-50"><input type="radio" name="cau2" value="D"> D. 5 g√≥c vu√¥ng</label>
            </div>
            <div class="explanation" id="giai_cau2">üí° <b>ƒê√°p √°n:</b> A (2 g√≥c vu√¥ng)</div>
        </div>

        <div class="question-box" id="box_cau3">
            <label class="question-title">C√¢u 3 (0.5ƒë): Trong s·ªë 806 217 435, ch·ªØ s·ªë 1 thu·ªôc h√†ng n√†o, l·ªõp n√†o?</label>
            <div class="grid gap-2" id="group_cau3">
                <label class="p-2 rounded border cursor-pointer hover:bg-gray-50"><input type="radio" name="cau3" value="A"> A. H√†ng ch·ª•c, l·ªõp ƒë∆°n v·ªã</label>
                <label class="p-2 rounded border cursor-pointer hover:bg-gray-50"><input type="radio" name="cau3" value="B"> B. H√†ng ch·ª•c ngh√¨n, l·ªõp ngh√¨n</label>
                <label class="p-2 rounded border cursor-pointer hover:bg-gray-50"><input type="radio" name="cau3" value="C"> C. H√†ng ch·ª•c tri·ªáu, l·ªõp tri·ªáu</label>
            </div>
            <div class="explanation" id="giai_cau3">üí° <b>ƒê√°p √°n:</b> B. H√†ng ch·ª•c ngh√¨n, l·ªõp ngh√¨n.</div>
        </div>

        <div class="question-box" id="box_cau4">
            <label class="question-title">C√¢u 4 (0.5ƒë): L√†m tr√≤n s·ªë 28 640 275 ƒë·∫øn h√†ng tri·ªáu?</label>
            <div class="grid grid-cols-2 gap-2" id="group_cau4">
                <label class="p-2 rounded border cursor-pointer hover:bg-gray-50"><input type="radio" name="cau4" value="A"> A. 28 000 000</label>
                <label class="p-2 rounded border cursor-pointer hover:bg-gray-50"><input type="radio" name="cau4" value="B"> B. 29 000 000</label>
                <label class="p-2 rounded border cursor-pointer hover:bg-gray-50"><input type="radio" name="cau4" value="C"> C. 28 600 000</label>
            </div>
            <div class="explanation" id="giai_cau4">üí° <b>ƒê√°p √°n:</b> B. 29 000 000<br><i>(V√¨ ch·ªØ s·ªë h√†ng trƒÉm ngh√¨n l√† 6 > 5 n√™n l√†m tr√≤n l√™n).</i></div>
        </div>

        <div class="question-box" id="box_cau5">
            <label class="question-title">C√¢u 5 (0.5ƒë): 5 183 748 > 5 ...83 748. S·ªë c·∫ßn ƒëi·ªÅn l√†:</label>
            <div class="grid grid-cols-4 gap-2" id="group_cau5">
                <label class="p-2 rounded border cursor-pointer hover:bg-gray-50"><input type="radio" name="cau5" value="A"> A. 0</label>
                <label class="p-2 rounded border cursor-pointer hover:bg-gray-50"><input type="radio" name="cau5" value="B"> B. 1</label>
                <label class="p-2 rounded border cursor-pointer hover:bg-gray-50"><input type="radio" name="cau5" value="C"> C. 2</label>
                <label class="p-2 rounded border cursor-pointer hover:bg-gray-50"><input type="radio" name="cau5" value="D"> D. 3</label>
            </div>
            <div class="explanation" id="giai_cau5">üí° <b>ƒê√°p √°n:</b> A. 0<br><i>(Ch·ªâ c√≥ s·ªë 0 m·ªõi nh·ªè h∆°n s·ªë 1 ·ªü h√†ng trƒÉm ngh√¨n).</i></div>
        </div>

        <div class="question-box" id="box_cau6">
            <label class="question-title">C√¢u 6 (0.5ƒë): 2 t·∫° 5 kg = ...... kg</label>
            <input type="number" id="cau6" placeholder="...">
            <div class="explanation" id="giai_cau6">üí° <b>ƒê√°p √°n:</b> 205<br><i>(2 t·∫° = 200kg; 200 + 5 = 205).</i></div>
        </div>

        <div class="question-box" id="box_cau7">
            <label class="question-title">C√¢u 7 (0.5ƒë): C·∫°nh MN vu√¥ng g√≥c v·ªõi nh·ªØng c·∫°nh n√†o?</label>
            <img src="../images/toan/de1/Cau7.jpg" alt="Hinh 7" class="my-3 max-h-40 rounded border shadow-sm block">
            <div class="grid gap-2" id="group_cau7">
                <label class="p-2 rounded border cursor-pointer hover:bg-gray-50"><input type="radio" name="cau7" value="A"> A. PH v√† QK</label>
                <label class="p-2 rounded border cursor-pointer hover:bg-gray-50"><input type="radio" name="cau7" value="B"> B. PQ v√† HK</label>
                <label class="p-2 rounded border cursor-pointer hover:bg-gray-50"><input type="radio" name="cau7" value="C"> C. Song song v·ªõi PH v√† QK</label>
            </div>
            <div class="explanation" id="giai_cau7">üí° <b>ƒê√°p √°n:</b> A. PH v√† QK</div>
        </div>

        <div class="question-box" id="box_cau8">
            <label class="question-title">C√¢u 8 (0.5ƒë): Gi√° tr·ªã bi·ªÉu th·ª©c a x b ‚Äì c (v·ªõi a = 4219, b = 6, c = 1875):</label>
            <div class="grid grid-cols-2 gap-2" id="group_cau8">
                <label class="p-2 rounded border cursor-pointer hover:bg-gray-50"><input type="radio" name="cau8" value="A"> A. 25 314</label>
                <label class="p-2 rounded border cursor-pointer hover:bg-gray-50"><input type="radio" name="cau8" value="B"> B. 27 189</label>
                <label class="p-2 rounded border cursor-pointer hover:bg-gray-50"><input type="radio" name="cau8" value="C"> C. 23 439</label>
            </div>
            <div class="explanation" id="giai_cau8">üí° <b>ƒê√°p √°n:</b> C. 23 439<br><i>(4219 x 6 = 25314; 25314 - 1875 = 23439).</i></div>
        </div>

        <div class="section-header border-l-4 border-orange-500 bg-orange-50 text-orange-800">II. T·ª± Lu·∫≠n (5.5 ƒëi·ªÉm)</div>
        <p class="mb-4 text-sm text-gray-500 italic">* Con h√£y tr√¨nh b√†y l·ªùi gi·∫£i v√†o √¥ tr·ªëng b√™n d∆∞·ªõi.</p>

        <div class="question-box bg-orange-50">
            <label class="question-title">C√¢u 9 (2ƒë): ƒê·∫∑t t√≠nh r·ªìi t√≠nh:</label>
            <div class="grid grid-cols-1 gap-4 mt-2">
                <div>
                    <span class="text-sm font-bold">a) 25 706 + 92 817</span>
                    <textarea id="cau9a" rows="2" placeholder="Nh·∫≠p k·∫øt qu·∫£ ho·∫∑c c√°ch t√≠nh..."></textarea>
                    <div class="explanation" id="giai_cau9a">‚úÖ <b>ƒê√°p √°n:</b> 118 523</div>
                </div>
                <div>
                    <span class="text-sm font-bold">b) 86 231 ‚Äì 19 302</span>
                    <textarea id="cau9b" rows="2" placeholder="Nh·∫≠p k·∫øt qu·∫£ ho·∫∑c c√°ch t√≠nh..."></textarea>
                    <div class="explanation" id="giai_cau9b">‚úÖ <b>ƒê√°p √°n:</b> 66 929</div>
                </div>
                <div>
                    <span class="text-sm font-bold">c) 2845 x 6</span>
                    <textarea id="cau9c" rows="2" placeholder="Nh·∫≠p k·∫øt qu·∫£ ho·∫∑c c√°ch t√≠nh..."></textarea>
                    <div class="explanation" id="giai_cau9c">‚úÖ <b>ƒê√°p √°n:</b> 17 070</div>
                </div>
                <div>
                    <span class="text-sm font-bold">d) 2148 : 3</span>
                    <textarea id="cau9d" rows="2" placeholder="Nh·∫≠p k·∫øt qu·∫£ ho·∫∑c c√°ch t√≠nh..."></textarea>
                    <div class="explanation" id="giai_cau9d">‚úÖ <b>ƒê√°p √°n:</b> 716</div>
                </div>
            </div>
        </div>

        <div class="question-box bg-orange-50">
            <label class="question-title">C√¢u 10 (0.5ƒë): T√≠nh b·∫±ng c√°ch thu·∫≠n ti·ªán: 4 197 + 2500 + 3 403</label>
            <textarea id="cau10" placeholder="Tr√¨nh b√†y c√°c b∆∞·ªõc t√≠nh nhanh..."></textarea>
            <div class="explanation" id="giai_cau10">
                üìù <b>H∆∞·ªõng d·∫´n gi·∫£i chi ti·∫øt:</b><br>
                4 197 + 2500 + 3 403<br>
                = (4 197 + 3 403) + 2500 <i>(S·ª≠ d·ª•ng t√≠nh ch·∫•t giao ho√°n)</i><br>
                = 7 600 + 2500<br>
                = <b>10 100</b>
            </div>
        </div>

        <div class="question-box bg-orange-50">
            <label class="question-title">C√¢u 11 (1ƒë): H√¨nh ch·ªØ nh·∫≠t c√≥ chu vi 42 cm, chi·ªÅu d√†i h∆°n chi·ªÅu r·ªông 9 cm. T√≠nh chi·ªÅu r·ªông?</label>
            <textarea id="cau11" placeholder="B√†i gi·∫£i..."></textarea>
            <div class="explanation" id="giai_cau11">
                üìù <b>H∆∞·ªõng d·∫´n gi·∫£i chi ti·∫øt:</b><br>
                <b>B∆∞·ªõc 1:</b> T√≠nh n·ª≠a chu vi h√¨nh ch·ªØ nh·∫≠t:<br>
                42 : 2 = 21 (cm)<br>
                <b>B∆∞·ªõc 2:</b> T√¨m chi·ªÅu r·ªông (B√†i to√°n T·ªïng - Hi·ªáu):<br>
                (21 - 9) : 2 = 6 (cm)<br>
                <b>ƒê√°p s·ªë:</b> 6 cm
            </div>
        </div>

        <div class="question-box bg-orange-50">
            <label class="question-title">C√¢u 12 (2ƒë): Th√πng 180 l√≠t. L·∫ßn 1 l·∫•y 1/3. L·∫ßn 2 l·∫•y h∆°n l·∫ßn ƒë·∫ßu 20 l√≠t. H·ªèi c√≤n l·∫°i bao nhi√™u?</label>
            <textarea id="cau12" placeholder="B√†i gi·∫£i..."></textarea>
            <div class="explanation" id="giai_cau12">
                üìù <b>H∆∞·ªõng d·∫´n gi·∫£i chi ti·∫øt:</b><br>
                <b>B∆∞·ªõc 1:</b> S·ªë l√≠t n∆∞·ªõc l·∫•y ra l·∫ßn ƒë·∫ßu l√†:<br>
                180 x 1/3 = 60 (l√≠t)<br>
                <b>B∆∞·ªõc 2:</b> S·ªë l√≠t n∆∞·ªõc l·∫•y ra l·∫ßn th·ª© hai l√†:<br>
                60 + 20 = 80 (l√≠t)<br>
                <b>B∆∞·ªõc 3:</b> T·ªïng s·ªë n∆∞·ªõc ƒë√£ l·∫•y ra l√†:<br>
                60 + 80 = 140 (l√≠t)<br>
                <b>B∆∞·ªõc 4:</b> S·ªë l√≠t n∆∞·ªõc c√≤n l·∫°i trong th√πng l√†:<br>
                180 - 140 = 40 (l√≠t)<br>
                <b>ƒê√°p s·ªë:</b> 40 l√≠t
            </div>
        </div>

        <div class="text-center mt-10 pb-10">
            <button onclick="nopBai()" id="btnNopBai" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-10 rounded-full shadow-lg text-xl transition transform hover:scale-105">
                N·ªòP B√ÄI THI
            </button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyA77lLi_JCLIdR535KEfg3S0_Ge2EorPMo", 
            authDomain: "baikiemtracuoiki.firebaseapp.com",
            projectId: "baikiemtracuoiki",
            storageBucket: "baikiemtracuoiki.appspot.com",
            messagingSenderId: "953819948776",
            appId: "1:953819948776:web:15848507d350f37c35e5d3"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // ƒê√ÅP √ÅN TR·∫ÆC NGHI·ªÜM
        const KEY_TN = {
            radio: { cau2: "A", cau3: "B", cau4: "B", cau5: "A", cau7: "A", cau8: "C" },
            input: { cau1: 2181, cau6: 205 }
        };

        let daNop = false;
        let time = 35 * 60;
        const dongHo = document.getElementById('dongHo');
        
        const timer = setInterval(() => {
            if(daNop) { clearInterval(timer); return; }
            let m = Math.floor(time/60), s = time % 60;
            dongHo.innerText = `${m<10?'0'+m:m}:${s<10?'0'+s:s}`;
            time--;
            if(time<0) { nopBai(true); }
        }, 1000);

        window.nopBai = async function(auto=false) {
            if(daNop) return;
            const ht = document.getElementById('hoTen').value.trim();
            const lop = document.getElementById('lop').value.trim();
            if(!auto && (!ht || !lop)) { alert("Con ch∆∞a ƒëi·ªÅn t√™n/l·ªõp!"); return; }

            daNop = true;
            document.getElementById('btnNopBai').style.display = 'none';
            alert("ƒêang n·ªôp b√†i... Con h√£y k√©o xu·ªëng ƒë·ªÉ xem L·ªúI GI·∫¢I CHI TI·∫æT nh√©!");

            let diemTN = 0;

            // 1. CH·∫§M TR·∫ÆC NGHI·ªÜM
            for (const [id, dapAn] of Object.entries(KEY_TN.radio)) {
                const luaChon = document.querySelector(`input[name="${id}"]:checked`);
                const inputs = document.querySelectorAll(`input[name="${id}"]`);
                inputs.forEach(i => i.disabled = true);
                document.getElementById(`giai_${id}`).style.display = 'block';

                if (luaChon && luaChon.value === dapAn) {
                    diemTN += 0.5;
                    luaChon.parentElement.classList.add('correct-answer');
                } else {
                    if(luaChon) luaChon.parentElement.classList.add('wrong-answer');
                    const dung = document.querySelector(`input[name="${id}"][value="${dapAn}"]`);
                    if(dung) dung.parentElement.classList.add('correct-answer', 'ring-2', 'ring-green-500');
                }
            }
            // C√¢u 1, 6
            for (const [id, dapAn] of Object.entries(KEY_TN.input)) {
                const el = document.getElementById(id);
                el.disabled = true;
                document.getElementById(`giai_${id}`).style.display = 'block';
                let val = parseInt(el.value.replace(/\D/g,'')) || 0;
                if (val === dapAn) {
                    diemTN += 0.5;
                    el.classList.add('bg-green-100', 'border-green-500', 'text-green-700');
                } else {
                    el.classList.add('bg-red-100', 'border-red-500', 'text-red-700');
                }
            }

            // 2. X·ª¨ L√ù T·ª∞ LU·∫¨N
            // Kh√≥a √¥ nh·∫≠p li·ªáu v√† Hi·ªán l·ªùi gi·∫£i chi ti·∫øt
            ['cau9a','cau9b','cau9c','cau9d','cau10','cau11','cau12'].forEach(id => {
                const el = document.getElementById(id);
                if(el) {
                    el.disabled = true; 
                    el.style.backgroundColor = "#f3f4f6"; // L√†m t·ªëi m√†u ƒë·ªÉ bi·∫øt ƒë√£ kh√≥a
                    const giai = document.getElementById(`giai_${id}`);
                    if(giai) giai.style.display = 'block'; // Hi·ªán l·ªùi gi·∫£i
                }
            });

            // L·∫•y n·ªôi dung h·ªçc sinh l√†m ƒë·ªÉ l∆∞u
            const noiDungTuLuan = `
                [9a] ${document.getElementById('cau9a').value}
                [9b] ${document.getElementById('cau9b').value}
                [9c] ${document.getElementById('cau9c').value}
                [9d] ${document.getElementById('cau9d').value}
                [10] ${document.getElementById('cau10').value}
                [11] ${document.getElementById('cau11').value}
                [12] ${document.getElementById('cau12').value}
            `;

            try {
                await addDoc(collection(db, "Baikiemtracuoiki"), {
                    ho_ten: ht, lop: lop, 
                    mon_hoc: "To√°n", ma_de: "ƒê·ªÅ 01",
                    diem_trac_nghiem: diemTN, 
                    diem_tu_luan: 0, 
                    bai_tu_luan: noiDungTuLuan,
                    tong_diem: diemTN,
                    ghi_chu: "Ch·ªù ch·∫•m T·ª± lu·∫≠n",
                    thoi_gian_nop: new Date().toISOString(),
                    nop_tu_dong: auto ? "C√≥" : "Kh√¥ng"
                });
                alert(`N·ªôp th√†nh c√¥ng!\nƒêi·ªÉm Tr·∫Øc nghi·ªám: ${diemTN}/4 ƒëi·ªÉm.\nCon h√£y xem l·∫°i L·ªúI GI·∫¢I CHI TI·∫æT b√™n d∆∞·ªõi nh√©!`);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            } catch(e) {
                alert("L·ªói n·ªôp b√†i: " + e.message);
            }
        }
    </script>
</body>
</html>
