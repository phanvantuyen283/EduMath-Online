<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ƒê·ªÅ To√°n S·ªë 1 - C√≥ L·ªùi Gi·∫£i</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Nunito', sans-serif; }
        .question-box { background-color: #F9FAFB; border-left: 4px solid #3B82F6; padding: 1rem; margin-bottom: 1.5rem; border-radius: 0.5rem; transition: all 0.3s; }
        .question-title { font-weight: 700; color: #1F2937; margin-bottom: 0.5rem; display: block; }
        input[type="radio"] { width: 1.2rem; height: 1.2rem; margin-right: 0.5rem; vertical-align: middle; }
        input[type="text"], input[type="number"] { border: 1px solid #D1D5DB; padding: 0.5rem; border-radius: 0.25rem; width: 100%; max-width: 200px; font-weight: bold; color: #1E40AF; }
        .section-header { background-color: #DBEAFE; color: #1E3A8A; font-weight: 900; padding: 0.75rem; border-radius: 0.5rem; margin-bottom: 1rem; text-transform: uppercase; }
        
        /* Style cho k·∫øt qu·∫£ */
        .correct-answer { background-color: #DCFCE7 !important; border-color: #22C55E !important; } /* Xanh l√° */
        .wrong-answer { background-color: #FEE2E2 !important; border-color: #EF4444 !important; } /* ƒê·ªè */
        .explanation { display: none; margin-top: 10px; padding: 10px; background-color: #FFF7ED; border: 1px dashed #F97316; border-radius: 5px; color: #9A3412; font-size: 0.9rem; }
    </style>
</head>
<body class="bg-blue-50 py-8 min-h-screen">

    <div class="fixed top-4 right-4 bg-red-600 text-white font-bold py-2 px-4 rounded-full shadow-lg z-50 animate-pulse border-2 border-white">
        ‚è≥ <span id="dongHo">35:00</span>
    </div>

    <div class="max-w-4xl mx-auto bg-white p-8 rounded-xl shadow-xl">
        
        <div class="text-center mb-8 border-b-2 border-blue-200 pb-4">
            <h1 class="text-3xl font-black text-blue-800 uppercase">KI·ªÇM TRA CU·ªêI H·ªåC K√å 1</h1>
            <p class="text-xl text-gray-600 font-bold mt-2">M√¥n: TO√ÅN - L·ªõp 4</p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8 bg-blue-50 p-4 rounded-lg">
            <div>
                <label class="block font-bold text-gray-700">H·ªç v√† t√™n:</label>
                <input type="text" id="hoTen" class="w-full mt-1 p-2 border rounded outline-none">
            </div>
            <div>
                <label class="block font-bold text-gray-700">L·ªõp:</label>
                <input type="text" id="lop" class="w-full mt-1 p-2 border rounded outline-none">
            </div>
        </div>

        <div class="section-header">I. Tr·∫Øc Nghi·ªám</div>

        <div class="question-box" id="box_cau1">
            <label class="question-title">C√¢u 1: ƒêi·ªÅn s·ªë th√≠ch h·ª£p: 2 175, 2 177, 2 179, ...</label>
            <input type="number" id="cau1" placeholder="...">
            <div class="explanation" id="giai_cau1">üí° <b>Gi·∫£i th√≠ch:</b> D√£y s·ªë l·∫ª li√™n ti·∫øp tƒÉng d·∫ßn 2 ƒë∆°n v·ªã. 2179 + 2 = 2181.</div>
        </div>

        <div class="question-box" id="box_cau2">
            <label class="question-title">C√¢u 2: H√¨nh v·∫Ω c√≥ bao nhi√™u g√≥c vu√¥ng?</label>
            <img src="../images/toan/de1/Cau2.jpg" class="my-3 max-h-40 rounded border block">
            <div class="grid grid-cols-2 gap-2" id="group_cau2">
                <label class="p-2 rounded border cursor-pointer hover:bg-gray-50"><input type="radio" name="cau2" value="A"> A. 2 g√≥c vu√¥ng</label>
                <label class="p-2 rounded border cursor-pointer hover:bg-gray-50"><input type="radio" name="cau2" value="B"> B. 3 g√≥c vu√¥ng</label>
                <label class="p-2 rounded border cursor-pointer hover:bg-gray-50"><input type="radio" name="cau2" value="C"> C. 4 g√≥c vu√¥ng</label>
                <label class="p-2 rounded border cursor-pointer hover:bg-gray-50"><input type="radio" name="cau2" value="D"> D. 5 g√≥c vu√¥ng</label>
            </div>
            <div class="explanation" id="giai_cau2">üí° <b>Gi·∫£i th√≠ch:</b> Quan s√°t h√¨nh v·∫Ω ta th·∫•y c√≥ 2 g√≥c vu√¥ng (ƒë√°nh d·∫•u vu√¥ng g√≥c). ƒê√°p √°n A.</div>
        </div>

        <div class="question-box" id="box_cau3">
            <label class="question-title">C√¢u 3: Trong s·ªë 806 217 435, ch·ªØ s·ªë 1 thu·ªôc h√†ng n√†o, l·ªõp n√†o?</label>
            <div class="grid gap-2" id="group_cau3">
                <label class="p-2 rounded border cursor-pointer hover:bg-gray-50"><input type="radio" name="cau3" value="A"> A. H√†ng ch·ª•c, l·ªõp ƒë∆°n v·ªã</label>
                <label class="p-2 rounded border cursor-pointer hover:bg-gray-50"><input type="radio" name="cau3" value="B"> B. H√†ng ch·ª•c ngh√¨n, l·ªõp ngh√¨n</label>
                <label class="p-2 rounded border cursor-pointer hover:bg-gray-50"><input type="radio" name="cau3" value="C"> C. H√†ng ch·ª•c tri·ªáu, l·ªõp tri·ªáu</label>
            </div>
            <div class="explanation" id="giai_cau3">üí° <b>Gi·∫£i th√≠ch:</b> S·ªë 1 n·∫±m ·ªü v·ªã tr√≠ th·ª© 5 t·ª´ ph·∫£i sang tr√°i -> H√†ng ch·ª•c ngh√¨n, L·ªõp ngh√¨n.</div>
        </div>

        <div class="question-box" id="box_cau4">
            <label class="question-title">C√¢u 4: L√†m tr√≤n s·ªë 28 640 275 ƒë·∫øn h√†ng tri·ªáu?</label>
            <div class="grid grid-cols-2 gap-2" id="group_cau4">
                <label class="p-2 rounded border cursor-pointer hover:bg-gray-50"><input type="radio" name="cau4" value="A"> A. 28 000 000</label>
                <label class="p-2 rounded border cursor-pointer hover:bg-gray-50"><input type="radio" name="cau4" value="B"> B. 29 000 000</label>
                <label class="p-2 rounded border cursor-pointer hover:bg-gray-50"><input type="radio" name="cau4" value="C"> C. 28 600 000</label>
            </div>
            <div class="explanation" id="giai_cau4">üí° <b>Gi·∫£i th√≠ch:</b> Ch·ªØ s·ªë h√†ng trƒÉm ngh√¨n l√† 6 (l·ªõn h∆°n 5) n√™n ta l√†m tr√≤n l√™n. 28 th√†nh 29 tri·ªáu.</div>
        </div>

        <div class="question-box" id="box_cau5">
            <label class="question-title">C√¢u 5: Ch·ªØ s·ªë th√≠ch h·ª£p: 5 183 748 > 5 ...83 748 l√†:</label>
            <div class="grid grid-cols-4 gap-2" id="group_cau5">
                <label class="p-2 rounded border cursor-pointer hover:bg-gray-50"><input type="radio" name="cau5" value="A"> A. 0</label>
                <label class="p-2 rounded border cursor-pointer hover:bg-gray-50"><input type="radio" name="cau5" value="B"> B. 1</label>
                <label class="p-2 rounded border cursor-pointer hover:bg-gray-50"><input type="radio" name="cau5" value="C"> C. 2</label>
                <label class="p-2 rounded border cursor-pointer hover:bg-gray-50"><input type="radio" name="cau5" value="D"> D. 3</label>
            </div>
            <div class="explanation" id="giai_cau5">üí° <b>Gi·∫£i th√≠ch:</b> C√°c h√†ng kh√°c gi·ªëng nhau. ƒê·ªÉ 1 > ..., th√¨ ... ph·∫£i nh·ªè h∆°n 1. Ch·ªâ c√≥ s·ªë 0 th·ªèa m√£n.</div>
        </div>

        <div class="question-box" id="box_cau6">
            <label class="question-title">C√¢u 6: 2 t·∫° 5 kg = ...... kg</label>
            <input type="number" id="cau6" placeholder="...">
            <div class="explanation" id="giai_cau6">üí° <b>Gi·∫£i th√≠ch:</b> 2 t·∫° = 200 kg. V·∫≠y 200 + 5 = 205 kg.</div>
        </div>

        <div class="question-box" id="box_cau7">
            <label class="question-title">C√¢u 7: C·∫°nh MN vu√¥ng g√≥c v·ªõi nh·ªØng c·∫°nh n√†o?</label>
            <img src="../images/toan/de1/Cau7.jpg" class="my-3 max-h-40 rounded border block">
            <div class="grid gap-2" id="group_cau7">
                <label class="p-2 rounded border cursor-pointer hover:bg-gray-50"><input type="radio" name="cau7" value="A"> A. PH v√† QK</label>
                <label class="p-2 rounded border cursor-pointer hover:bg-gray-50"><input type="radio" name="cau7" value="B"> B. PQ v√† HK</label>
                <label class="p-2 rounded border cursor-pointer hover:bg-gray-50"><input type="radio" name="cau7" value="C"> C. Song song PH, QK</label>
            </div>
            <div class="explanation" id="giai_cau7">üí° <b>Gi·∫£i th√≠ch:</b> Trong h√¨nh ch·ªØ nh·∫≠t, c·∫°nh chi·ªÅu d√†i vu√¥ng g√≥c v·ªõi c·∫°nh chi·ªÅu r·ªông. MN vu√¥ng g√≥c v·ªõi c·∫°nh ƒë·ª©ng l√† PH v√† QK.</div>
        </div>

        <div class="question-box" id="box_cau8">
            <label class="question-title">C√¢u 8: Gi√° tr·ªã bi·ªÉu th·ª©c a x b ‚Äì c (a=4219, b=6, c=1875):</label>
            <div class="grid grid-cols-2 gap-2" id="group_cau8">
                <label class="p-2 rounded border cursor-pointer hover:bg-gray-50"><input type="radio" name="cau8" value="A"> A. 25 314</label>
                <label class="p-2 rounded border cursor-pointer hover:bg-gray-50"><input type="radio" name="cau8" value="B"> B. 27 189</label>
                <label class="p-2 rounded border cursor-pointer hover:bg-gray-50"><input type="radio" name="cau8" value="C"> C. 23 439</label>
            </div>
            <div class="explanation" id="giai_cau8">üí° <b>Gi·∫£i th√≠ch:</b> 4219 x 6 = 25314. Sau ƒë√≥ 25314 - 1875 = 23439.</div>
        </div>

        <div class="section-header border-l-4 border-orange-500 bg-orange-50 text-orange-800">II. T·ª± Lu·∫≠n (Ch·ªâ ƒëi·ªÅn ƒë√°p s·ªë)</div>

        <div class="question-box bg-orange-50">
            <label class="question-title">C√¢u 9: T√≠nh gi√° tr·ªã:</label>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>a) 25 706 + 92 817 = <input type="number" id="cau9a"> <p class="explanation" id="giai_cau9a">ƒêS: 118523</p></div>
                <div>b) 86 231 ‚Äì 19 302 = <input type="number" id="cau9b"> <p class="explanation" id="giai_cau9b">ƒêS: 66929</p></div>
                <div>c) 2845 x 6 = <input type="number" id="cau9c"> <p class="explanation" id="giai_cau9c">ƒêS: 17070</p></div>
                <div>d) 2148 : 3 = <input type="number" id="cau9d"> <p class="explanation" id="giai_cau9d">ƒêS: 716</p></div>
            </div>
        </div>

        <div class="question-box bg-orange-50">
            <label class="question-title">C√¢u 10: T√≠nh thu·∫≠n ti·ªán: 4 197 + 2500 + 3 403 = ?</label>
            <input type="number" id="cau10">
            <div class="explanation" id="giai_cau10">üí° <b>HD:</b> (4197 + 3403) + 2500 = 7600 + 2500 = 10100.</div>
        </div>

        <div class="question-box bg-orange-50">
            <label class="question-title">C√¢u 11: H√¨nh ch·ªØ nh·∫≠t (P=42cm, D√†i h∆°n R·ªông 9cm). T√≠nh chi·ªÅu r·ªông?</label>
            <input type="number" id="cau11" style="width: 100px;"> cm
            <div class="explanation" id="giai_cau11">üí° <b>HD:</b> N·ª≠a chu vi: 42:2=21. Chi·ªÅu r·ªông: (21-9):2 = 6 (cm).</div>
        </div>

        <div class="question-box bg-orange-50">
            <label class="question-title">C√¢u 12: Th√πng 180L. L·∫ßn 1 l·∫•y 1/3. L·∫ßn 2 l·∫•y h∆°n l·∫ßn ƒë·∫ßu 20L. C√≤n l·∫°i?</label>
            <input type="number" id="cau12" style="width: 100px;"> l√≠t
            <div class="explanation" id="giai_cau12">üí° <b>HD:</b> L·∫ßn 1: 60L. L·∫ßn 2: 80L. T·ªïng l·∫•y: 140L. C√≤n l·∫°i: 180-140 = 40 (l√≠t).</div>
        </div>

        <div class="text-center mt-10">
            <button onclick="nopBai()" id="btnNopBai" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-10 rounded-full shadow-lg text-xl transition transform hover:scale-105">
                N·ªòP B√ÄI THI
            </button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyA77lLi_JCLIdR535KEfg3S0_Ge2EorPMo", 
            authDomain: "baikiemtracuoiki.firebaseapp.com",
            projectId: "baikiemtracuoiki",
            storageBucket: "baikiemtracuoiki.appspot.com",
            messagingSenderId: "953819948776",
            appId: "1:953819948776:web:15848507d350f37c35e5d3"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // ƒê√ÅP √ÅN V√Ä THANG ƒêI·ªÇM
        const KEY = {
            radio: {
                cau2: "A", cau3: "B", cau4: "B", cau5: "A", cau7: "A", cau8: "C"
            },
            input: {
                cau1: 2181, cau6: 205, 
                cau9a: 118523, cau9b: 66929, cau9c: 17070, cau9d: 716,
                cau10: 10100, cau11: 6, cau12: 40
            }
        };

        let daNop = false;
        let time = 35 * 60;
        const dongHo = document.getElementById('dongHo');
        const timer = setInterval(() => {
            if(daNop) { clearInterval(timer); return; }
            let m=Math.floor(time/60), s=time%60;
            dongHo.innerText = `${m<10?'0'+m:m}:${s<10?'0'+s:s}`;
            time--;
            if(time<0) { nopBai(true); }
        }, 1000);

        window.nopBai = async function(auto=false) {
            if(daNop) return;
            const ht = document.getElementById('hoTen').value;
            const lop = document.getElementById('lop').value;
            if(!auto && (!ht || !lop)) { alert("Con ch∆∞a ƒëi·ªÅn t√™n/l·ªõp!"); return; }

            daNop = true;
            document.getElementById('btnNopBai').style.display = 'none';
            alert("ƒêang ch·∫•m ƒëi·ªÉm... Con ƒë·ª£i ch√∫t nh√©!");

            let diem = 0;

            // 1. CH·∫§M TR·∫ÆC NGHI·ªÜM (RADIO)
            for (const [id, dapAn] of Object.entries(KEY.radio)) {
                const grp = document.getElementById(`group_${id}`);
                const luaChon = document.querySelector(`input[name="${id}"]:checked`);
                const inputs = document.querySelectorAll(`input[name="${id}"]`);
                
                // Kh√≥a input
                inputs.forEach(i => i.disabled = true);
                document.getElementById(`giai_${id}`).style.display = 'block';

                if (luaChon && luaChon.value === dapAn) {
                    diem += 0.5;
                    luaChon.parentElement.classList.add('correct-answer');
                } else {
                    if(luaChon) luaChon.parentElement.classList.add('wrong-answer');
                    // T√¥ m√†u ƒë√°p √°n ƒë√∫ng
                    const dung = document.querySelector(`input[name="${id}"][value="${dapAn}"]`);
                    if(dung) dung.parentElement.classList.add('correct-answer', 'ring-2', 'ring-green-500');
                }
            }

            // 2. CH·∫§M T·ª∞ LU·∫¨N/ƒêI·ªÄN S·ªê (INPUT)
            for (const [id, dapAn] of Object.entries(KEY.input)) {
                const el = document.getElementById(id);
                if(!el) continue;
                el.disabled = true;
                
                // Hi·ªÉn th·ªã gi·∫£i th√≠ch
                const giai = document.getElementById(`giai_${id}`);
                if(giai) giai.style.display = 'block';

                let val = parseInt(el.value.replace(/\D/g,'')) || 0;
                let diemCong = (id.includes('cau9') || id==='cau10' || id==='cau1' || id==='cau6') ? 0.5 : (id==='cau11'?1.0 : 2.0);

                if (val === dapAn) {
                    diem += diemCong;
                    el.classList.add('bg-green-100', 'border-green-500', 'text-green-700');
                } else {
                    el.classList.add('bg-red-100', 'border-red-500', 'text-red-700');
                    // Ghi ƒë√°p √°n ƒë√∫ng v√†o b√™n c·∫°nh n·∫øu sai
                    if(!giai) { // N·∫øu ch∆∞a c√≥ box gi·∫£i th√≠ch ri√™ng th√¨ th√™m text
                        let span = document.createElement('span');
                        span.className = "text-red-600 font-bold ml-2 text-sm";
                        span.innerText = `(ƒê√∫ng: ${dapAn})`;
                        el.parentNode.appendChild(span);
                    }
                }
            }

            // G·ª¨I FIREBASE
            try {
                await addDoc(collection(db, "Baikiemtracuoiki"), {
                    ho_ten: ht||"·∫®n danh", lop: lop||"?", mon_hoc: "To√°n",
                    diem_trac_nghiem: diem, diem_tu_luan: 0, // G·ªôp h·∫øt v√†o tr·∫Øc nghi·ªám cho g·ªçn
                    tong_diem: diem,
                    thoi_gian: new Date().toISOString()
                });
                alert(`ƒê√£ n·ªôp b√†i! ƒêi·ªÉm c·ªßa con: ${diem} / 9.5`);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            } catch(e) {
                alert("L·ªói n·ªôp: " + e.message);
            }
        }
    </script>
</body>
</html>
