<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đề Kiểm Tra Toán Lớp 4 - Đề Số 1</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Nunito', sans-serif; }
        .question-box { background-color: #f3f4f6; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .option-label { display: block; margin-bottom: 8px; cursor: pointer; }
        .input-text { border: 1px solid #d1d5db; padding: 8px; border-radius: 4px; width: 100%; max-width: 300px; }
    </style>
</head>
<body class="bg-blue-50 py-10">

    <div class="max-w-4xl mx-auto bg-white shadow-xl rounded-lg overflow-hidden">
        <div class="bg-blue-600 p-6 text-white text-center">
            <h1 class="text-2xl font-bold uppercase">Bài Kiểm Tra Định Kỳ Cuối Học Kỳ I</h1>
            <p class="text-lg mt-2">Môn thi: TOÁN – Lớp 4 (Đề 1)</p>
            <p class="text-sm italic">(Thời gian làm bài: 35 phút)</p> </div>

        <div class="p-8">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8 border-b pb-6">
                <div>
                    <label class="block text-gray-700 font-bold mb-2">Họ và tên học sinh:</label>
                    <input type="text" id="hoTen" class="w-full border-2 border-blue-200 p-3 rounded-lg focus:outline-none focus:border-blue-500" placeholder="Nhập họ tên của con...">
                </div>
                <div>
                    <label class="block text-gray-700 font-bold mb-2">Lớp:</label>
                    <input type="text" id="lop" class="w-full border-2 border-blue-200 p-3 rounded-lg focus:outline-none focus:border-blue-500" placeholder="Ví dụ: 4A">
                </div>
            </div>

            <h2 class="text-xl font-bold text-blue-800 mb-4 border-l-4 border-blue-600 pl-3">I. PHẦN TRẮC NGHIỆM</h2>
            <p class="mb-4 italic text-gray-600">Khoanh tròn vào chữ cái trước câu trả lời đúng hoặc viết đáp án vào chỗ chấm.</p> <div class="question-box">
                <p class="font-bold mb-2">Câu 1 (0,5 điểm): <span class="font-normal">Điền số thích hợp vào chỗ chấm: 2 175, 2 177, 2 179 , …………….</span></p> <input type="number" id="cau1" class="input-text" placeholder="Nhập số tiếp theo...">
            </div>

            <div class="question-box">
                <p class="font-bold mb-2">Câu 2 (0,5 điểm): <span class="font-normal">Hình vẽ sau đây có bao nhiêu góc vuông?</span></p> <div class="bg-gray-200 h-32 flex items-center justify-center mb-3 rounded border border-dashed border-gray-400">
                    <span class="text-gray-500">[Vị trí chèn ảnh các góc vuông]</span>
                    </div>
                <div class="grid grid-cols-2 gap-2">
                    <label class="option-label"><input type="radio" name="cau2" value="A"> A. 2 góc vuông</label>
                    <label class="option-label"><input type="radio" name="cau2" value="B"> B. 3 góc vuông</label>
                    <label class="option-label"><input type="radio" name="cau2" value="C"> C. 4 góc vuông</label>
                    <label class="option-label"><input type="radio" name="cau2" value="D"> D. 5 góc vuông</label> </div>
            </div>

            <div class="question-box">
                <p class="font-bold mb-2">Câu 3 (0,5 điểm): <span class="font-normal">Trong số 806 217 435, chữ số 1 thuộc hàng nào, lớp nào?</span></p> <label class="option-label"><input type="radio" name="cau3" value="A"> A. Hàng chục, lớp đơn vị.</label>
                <label class="option-label"><input type="radio" name="cau3" value="B"> B. Hàng chục nghìn, lớp nghìn.</label> <label class="option-label"><input type="radio" name="cau3" value="C"> C. Hàng chục triệu, lớp triệu.</label>
                <label class="option-label"><input type="radio" name="cau3" value="D"> D. Hàng triệu, lớp triệu.</label> </div>

            <div class="question-box">
                <p class="font-bold mb-2">Câu 4 (0,5 điểm): <span class="font-normal">Làm tròn số 28 640 275 đến hàng triệu ta được số nào?</span></p> <div class="grid grid-cols-2 gap-2">
                    <label class="option-label"><input type="radio" name="cau4" value="A"> A. 28 000 000</label>
                    <label class="option-label"><input type="radio" name="cau4" value="B"> B. 29 000 000</label>
                    <label class="option-label"><input type="radio" name="cau4" value="C"> C. 28 600 000</label>
                    <label class="option-label"><input type="radio" name="cau4" value="D"> D. 30 000 000</label> </div>
            </div>

            <div class="question-box">
                <p class="font-bold mb-2">Câu 5 (0,5 điểm): <span class="font-normal">Chữ số thích hợp điền vào chỗ chấm: 5 183 748 > 5 ...83 748 là:</span></p> <div class="grid grid-cols-4 gap-2">
                    <label class="option-label"><input type="radio" name="cau5" value="A"> A. 0</label>
                    <label class="option-label"><input type="radio" name="cau5" value="B"> B. 1</label>
                    <label class="option-label"><input type="radio" name="cau5" value="C"> C. 2</label>
                    <label class="option-label"><input type="radio" name="cau5" value="D"> D. 3</label> </div>
            </div>

            <div class="question-box">
                <p class="font-bold mb-2">Câu 6 (0,5 điểm): <span class="font-normal">Điền số thích hợp vào chỗ chấm: 2 tạ 5 kg = …….kg.</span></p> <input type="number" id="cau6" class="input-text" placeholder="Nhập kết quả...">
            </div>

            <div class="question-box">
                <p class="font-bold mb-2">Câu 7 (0,5 điểm): <span class="font-normal">Các hình PMNQ, MNKH, PHKQ đều là những hình chữ nhật. Hỏi cạnh MN vuông góc với những cạnh nào?</span></p> <div class="bg-gray-200 h-32 flex items-center justify-center mb-3 rounded border border-dashed border-gray-400">
                    <span class="text-gray-500">[Vị trí chèn ảnh hình chữ nhật PMNQ...]</span>
                </div>
                <label class="option-label"><input type="radio" name="cau7" value="A"> A. MN vuông góc với PH và QK.</label> <label class="option-label"><input type="radio" name="cau7" value="B"> B. MN vuông góc với PQ và HK.</label>
                <label class="option-label"><input type="radio" name="cau7" value="C"> C. MN song song với PH và QK.</label> </div>

            <div class="question-box">
                <p class="font-bold mb-2">Câu 8 (0,5 điểm): <span class="font-normal">Giá trị của biểu thức a x b – c với a = 4 219, b = 6 và c = 1 875 là:</span></p> <div class="grid grid-cols-2 gap-2">
                    <label class="option-label"><input type="radio" name="cau8" value="A"> A. 25 314</label>
                    <label class="option-label"><input type="radio" name="cau8" value="B"> B. 27 189</label>
                    <label class="option-label"><input type="radio" name="cau8" value="C"> C. 23 439</label>
                    <label class="option-label"><input type="radio" name="cau8" value="D"> D. 23 449</label> </div>
            </div>

            <h2 class="text-xl font-bold text-blue-800 mb-4 border-l-4 border-blue-600 pl-3 mt-8">II. PHẦN TỰ LUẬN</h2>
            
            <div class="mb-6">
                <p class="font-bold mb-2">Câu 9 (2 điểm): Đặt tính rồi tính</p> <p class="text-sm text-gray-600 mb-2">Gồm: 25 706 + 92 817 ; 86 231 – 19 302 ; 2845 x 6 ; 2148 : 3</p>
                <textarea id="cau9_tuluan" rows="4" class="w-full border p-3 rounded bg-yellow-50 focus:bg-white" placeholder="Con hãy nhập kết quả hoặc trình bày cách tính vào đây..."></textarea>
            </div>

            <div class="mb-6">
                <p class="font-bold mb-2">Câu 10 (0,5 điểm): Tính bằng cách thuận tiện</p> <p class="mb-2">4 197 + 2 500 + 3 403 = ?</p>
                <textarea id="cau10_tuluan" rows="3" class="w-full border p-3 rounded bg-yellow-50 focus:bg-white" placeholder="Trình bày bài làm..."></textarea>
            </div>

            <div class="mb-6">
                <p class="font-bold mb-2">Câu 11 (1 điểm): Bài toán hình học</p> 
                <p class="mb-2">Một hình chữ nhật có chu vi là 42 cm, chiều dài hơn chiều rộng 9 cm. Tính chiều rộng của hình chữ nhật đó?</p> <textarea id="cau11_tuluan" rows="5" class="w-full border p-3 rounded bg-yellow-50 focus:bg-white" placeholder="Bài giải..."></textarea>
            </div>

            <div class="mb-6">
                <p class="font-bold mb-2">Câu 12 (2 điểm): Bài toán đố</p>
                <p class="mb-2">Một thùng nước lọc có 180 l. Lần đầu lấy ra 1/3 số lít nước có trong thùng. Lần thứ hai lấy ra nhiều hơn lần đầu 20 l. Hỏi trong thùng còn lại bao nhiêu lít nước lọc?</p> <textarea id="cau12_tuluan" rows="5" class="w-full border p-3 rounded bg-yellow-50 focus:bg-white" placeholder="Bài giải..."></textarea>
            </div>

            <div class="text-center mt-10">
                <button onclick="nopBai()" class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-10 rounded-full shadow-lg transform transition hover:scale-105 text-lg">
                    NỘP BÀI THI
                </button>
                <p class="text-sm text-gray-500 mt-2">Hãy kiểm tra kỹ bài làm trước khi ấn nút nộp con nhé!</p>
            </div>
        </div>
    </div>

    <script type="module">
        // 1. IMPORT FIREBASE
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // 2. CẤU HÌNH (BẠN THAY API KEY VÀO ĐÂY)
        const firebaseConfig = {
           apiKey: "AIzaSyA77lLi_JCLIdR535KEfg3S0_Ge2EorPMo",
           authDomain: "baikiemtracuoiki.firebaseapp.com",
           projectId: "baikiemtracuoiki",
           storageBucket: "baikiemtracuoiki.firebasestorage.app",
           messagingSenderId: "953819948776",
           appId: "1:953819948776:web:22b2fada72ab36e0d28b5d",
           measurementId: "G-6S1RGY8XZ0" 
        };

        // Khởi tạo
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // ĐỊNH NGHĨA THÔNG TIN ĐỀ THI (QUAN TRỌNG ĐỂ PHÂN LOẠI)
        const MON_HOC = "Toán";
        const MA_DE = "Đề 01";

        // 3. HÀM NỘP BÀI
        window.nopBai = async function() {
            const btnNop = document.querySelector('button');
            btnNop.innerText = "Đang nộp bài...";
            btnNop.disabled = true;

            // A. Lấy thông tin học sinh
            const hoTen = document.getElementById('hoTen').value.trim();
            const lop = document.getElementById('lop').value.trim();

            if (!hoTen || !lop) {
                alert("Con chưa điền Tên hoặc Lớp!");
                btnNop.innerText = "NỘP BÀI THI";
                btnNop.disabled = false;
                return;
            }

            // B. Chấm điểm trắc nghiệm (Tự động)
            let diemTN = 0;
            
            [cite_start]// Câu 1: Điền số 2181[span_0](end_span)[span_1](end_span)
            const tlCau1 = document.getElementById('cau1').value.trim();
            if (tlCau1 == "2181" || tlCau1 == "2 181") diemTN += 0.5;

            [span_2](start_span)[span_3](start_span)// Câu 2: Đáp án D (5 góc vuông)[span_2](end_span)[span_3](end_span)
            const tlCau2 = document.querySelector('input[name="cau2"]:checked');
            if (tlCau2 && tlCau2.value === "D") diemTN += 0.5;

            [span_4](start_span)[span_5](start_span)// Câu 3: Đáp án B (Hàng chục nghìn)[span_4](end_span)[span_5](end_span)
            const tlCau3 = document.querySelector('input[name="cau3"]:checked');
            if (tlCau3 && tlCau3.value === "B") diemTN += 0.5;

            [span_6](start_span)[span_7](start_span)// Câu 4: Đáp án B (29 triệu)[span_6](end_span)[span_7](end_span)
            const tlCau4 = document.querySelector('input[name="cau4"]:checked');
            if (tlCau4 && tlCau4.value === "B") diemTN += 0.5;

            [span_8](start_span)[span_9](start_span)// Câu 5: Đáp án A (0)[span_8](end_span)[span_9](end_span)
            const tlCau5 = document.querySelector('input[name="cau5"]:checked');
            if (tlCau5 && tlCau5.value === "A") diemTN += 0.5;

            [span_10](start_span)[span_11](start_span)// Câu 6: Điền số 2005[span_10](end_span)[span_11](end_span)
            const tlCau6 = document.getElementById('cau6').value.trim();
            if (tlCau6 == "2005" || tlCau6 == "2 005") diemTN += 0.5;

            [span_12](start_span)[span_13](start_span)// Câu 7: Đáp án A (Vuông góc PH, QK)[span_12](end_span)[span_13](end_span)
            const tlCau7 = document.querySelector('input[name="cau7"]:checked');
            if (tlCau7 && tlCau7.value === "A") diemTN += 0.5;

            [span_14](start_span)[span_15](start_span)// Câu 8: Đáp án C (23 439)[span_14](end_span)[span_15](end_span)
            const tlCau8 = document.querySelector('input[name="cau8"]:checked');
            if (tlCau8 && tlCau8.value === "C") diemTN += 0.5;

            // C. Lấy nội dung tự luận
            const baiTuLuan = `
                Câu 9: ${document.getElementById('cau9_tuluan').value}
                Câu 10: ${document.getElementById('cau10_tuluan').value}
                Câu 11: ${document.getElementById('cau11_tuluan').value}
                Câu 12: ${document.getElementById('cau12_tuluan').value}
            `;

            // D. Gửi lên Firebase (Vào ngăn Baikiemtracuoiki)
            try {
                await addDoc(collection(db, "Baikiemtracuoiki"), {
                    ho_ten: hoTen,
                    lop: lop,
                    mon_hoc: MON_HOC,   // Toán
                    ma_de: MA_DE,       // Đề 01
                    diem_trac_nghiem: diemTN,
                    diem_tu_luan: 0,    // Mặc định, cô sẽ chấm sau
                    bai_tu_luan: baiTuLuan,
                    nhan_xet: "",
                    thoi_gian_nop: new Date().toISOString()
                });

                alert(`Chúc mừng con đã nộp bài thành công!\nĐiểm trắc nghiệm của con là: ${diemTN} điểm.`);
                // Ẩn nút nộp để tránh nộp 2 lần
                btnNop.style.display = 'none';
            } catch (e) {
                console.error("Lỗi: ", e);
                alert("Có lỗi xảy ra! Con hãy báo cô giáo ngay nhé.");
                btnNop.innerText = "NỘP BÀI THI";
                btnNop.disabled = false;
            }
        }
    </script>
</body>
</html>
